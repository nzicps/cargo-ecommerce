{% extends 'base.html' %}
{% block title %}Checkout{% endblock %}
{% block content %}
<div class="card shadow-lg p-4 rounded-3">
  <h2 class="text-center mb-4 text-primary fw-bold">Checkout</h2>
  <p class="text-center text-muted mb-5">Review your items before confirming your order.</p>
  <div class="table-responsive">
    <table class="table table-striped table-hover align-middle">
      <thead class="table-primary">
        <tr><th>Product</th><th class="text-center">Quantity</th><th class="text-end">Price</th><th class="text-end">Total</th></tr>
      </thead>
      <tbody id="checkout-table-body"></tbody>
    </table>
  </div>
  <div class="text-end mt-3">
    <h4 id="checkout-total" class="fw-bold text-success">Total: .00</h4>
  </div>
  <form method="post" action="{% url 'order_success' %}" class="text-end mt-4">
    {% csrf_token %}
    <input type="hidden" name="cart_data" id="cart_data_input">
    <button type="submit" class="btn btn-success btn-lg px-4 py-2">Confirm Order</button>
  </form>
</div>
<script>
function loadCheckout() {
  const cart = JSON.parse(localStorage.getItem('miniCart') || '{}');
  const tbody = document.getElementById('checkout-table-body');
  const totalField = document.getElementById('checkout-total');
  const input = document.getElementById('cart_data_input');
  let total = 0;
  tbody.innerHTML = '';
  for (let key in cart) {
    const item = cart[key];
    const lineTotal = item.price * item.quantity;
    total += lineTotal;
    const row = document.createElement('tr');
    row.innerHTML = <td></td><td class="text-center"></td><td class="text-end">Green{item.price.toFixed(2)}</td><td class="text-end">Green{lineTotal.toFixed(2)}</td>;
    tbody.appendChild(row);
  }
  totalField.textContent = Total: Green{total.toFixed(2)};
  input.value = JSON.stringify(cart);
}
document.addEventListener('DOMContentLoaded', loadCheckout);
</script>
{% endblock %}
